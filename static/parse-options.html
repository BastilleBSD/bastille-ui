{{define "parse-options"}}
<script>
function updateOptions() {
    const optionsInput = document.getElementById("options");
    if (!optionsInput) return true;

    const checkboxes = document.querySelectorAll(".option-checkbox");
    let opts = [];

    for (const cb of checkboxes) {
        if (!cb.checked) continue;

        if (cb.dataset.hasValue === "true") {
            const targetId = cb.dataset.target;
            const valueInput =
                document.getElementById(targetId)?.querySelector("input");

            const val = valueInput?.value.trim();
            if (!val) {
                alert(`Value required for ${cb.value}`);
                return false;
            }
            opts.push(`${cb.value} ${val}`);
        } else {
            opts.push(cb.value);
        }
    }

    optionsInput.value = opts.join(" ");
    return true;
}

// auto show/hide value inputs
document.addEventListener("DOMContentLoaded", () => {
    document
        .querySelectorAll('.option-checkbox[data-has-value="true"]')
        .forEach(cb => {
            const target = document.getElementById(cb.dataset.target);
            if (!target) return;

            cb.addEventListener("change", () => {
                target.style.display = cb.checked ? "block" : "none";
            });
        });
});
</script>
{{end}}
