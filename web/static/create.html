{{define "content"}}
<form method="post" onsubmit="updateOptions()">

    <!-- Basic fields -->
    <input name="name" placeholder="Jail Name" required>
    <input name="release" placeholder="Release (14.0-RELEASE)" required>
    <input name="ip" placeholder="IP address" required>
    <input name="iface" placeholder="Interface (optional)">

    <!-- Hidden options field to submit all flags -->
    <input type="hidden" name="options" id="options">

    <fieldset style="margin:20px 0; border:none;">
        <legend>Options:</legend>

        <!-- Simple checkboxes -->
        <label><input type="checkbox" class="option-checkbox" value="-B"> Enable VNET. INTERFACE must be a bridge</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-C"> Create a clone jail (ZFS only)</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-D"> Use dual IPv4+6 networking</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-E"> Create an empty jail</label><br>
        <label><input type="checkbox" class="option-checkbox" id="gatewayCheckbox" value="-g"> Specify a default router/gateway</label>
        <div id="gatewayDiv" style="display:none; margin-left:20px;">
            <input type="text" name="gateway" placeholder="Gateway IP">
        </div>
        <label><input type="checkbox" class="option-checkbox" value="-L"> Create a Linux jail</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-M"> Use static/persistent MAC address</label><br>
        <label><input type="checkbox" class="option-checkbox" value="--no-validate"> Do not validate release name</label><br>
        <label><input type="checkbox" class="option-checkbox" value="--no-boot"> Set boot=off</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-P"> Enable VNET with interface as-is</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-p" id="priorityCheckbox"> Set priority value</label>
        <div id="priorityDiv" style="display:none; margin-left:20px;">
            <input type="text" name="priority" placeholder="Priority value">
        </div>
        <label><input type="checkbox" class="option-checkbox" value="-T"> Create a thick jail</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-V"> Enable VNET. Interface must be a physical interface</label><br>
        <label><input type="checkbox" class="option-checkbox" value="-v" id="vlanCheckbox"> Set VLAN ID (VNET only)</label>
        <div id="vlanDiv" style="display:none; margin-left:20px;">
            <input type="text" name="vlan" placeholder="VLAN ID">
        </div>
        <label><input type="checkbox" class="option-checkbox" value="-x"> Enable debug mode</label><br>
        <label><input type="checkbox" class="option-checkbox" id="zfsCheckbox"> Custom zfs options. Comma-separated</label>
        <div id="zfsDiv" style="display:none; margin-left:20px;">
            <input type="text" name="zfs" placeholder="ZFS options (comma-separated)">
        </div>

    </fieldset>

    <button type="submit">Create</button>
</form>

<script>
// Merge all checked options and their parameters into the hidden field
function updateOptions() {
    const checkboxes = document.querySelectorAll('.option-checkbox');
    const optionsInput = document.getElementById('options');
    let opts = [];

    checkboxes.forEach(cb => {
        if(cb.checked) {
            opts.push(cb.value);
        }
    });

    // Add values from conditional inputs
    const gateway = document.querySelector('input[name="gateway"]');
    if(gateway && gateway.value) opts.push(gateway.value);

    const priority = document.querySelector('input[name="priority"]');
    if(priority && priority.value) opts.push(priority.value);

    const vlan = document.querySelector('input[name="vlan"]');
    if(vlan && vlan.value) opts.push(vlan.value);

    const zfs = document.querySelector('input[name="zfs"]');
    if(zfs && zfs.value) opts.push(zfs.value);

    optionsInput.value = opts.join(' ');
}

// Toggle inputs visibility
document.getElementById('gatewayCheckbox').addEventListener('change', function() {
    document.getElementById('gatewayDiv').style.display = this.checked ? 'block' : 'none';
});
document.getElementById('priorityCheckbox').addEventListener('change', function() {
    document.getElementById('priorityDiv').style.display = this.checked ? 'block' : 'none';
});
document.getElementById('vlanCheckbox').addEventListener('change', function() {
    document.getElementById('vlanDiv').style.display = this.checked ? 'block' : 'none';
});
document.getElementById('zfsCheckbox').addEventListener('change', function() {
    document.getElementById('zfsDiv').style.display = this.checked ? 'block' : 'none';
});
</script>

<!-- Output area -->
{{if .Output}}<pre>{{.Output}}</pre>{{end}}
{{if .Error}}<div class="error">{{.Error}}</div>{{end}}

<a class="button" href="/">Back</a>
{{end}}
