{{define "h2"}}Create a New Jail{{end}}
{{define "content"}}
<form method="post" onsubmit="updateOptions()">

    <input name="name" placeholder="Jail Name" required>
    <input name="release" placeholder="Release (14.0-RELEASE)" required>
    <input name="ip" placeholder="IP address" required>
    <input name="iface" placeholder="Interface (optional)">

    <input type="hidden" name="options" id="options">

    <fieldset>
        <legend>Options:</legend>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-B">
            <label>Enable VNET. INTERFACE must be a bridge</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-C">
            <label>Create a clone jail (ZFS only)</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-D">
            <label>Use dual IPv4+6 networking</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-E">
            <label>Create an empty jail</label>
        </div>

        <div class="option-block">
            <div class="option-row">
                <input type="checkbox" class="option-checkbox" id="gatewayCheckbox" value="-g">
                <label for="gatewayCheckbox">Specify a default router/gateway</label>
            </div>
            <div id="gatewayDiv" class="option-sub">
                <input type="text" name="gateway" placeholder="Gateway IP">
            </div>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-L">
            <label>Create a Linux jail</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-M">
            <label>Use static/persistent MAC address</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="--no-validate">
            <label>Do not validate release name</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="--no-boot">
            <label>Set boot=off</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-P">
            <label>Enable VNET with interface as-is</label>
        </div>

        <div class="option-block">
            <div class="option-row">
                <input type="checkbox" class="option-checkbox" id="priorityCheckbox" value="-p">
                <label for="priorityCheckbox">Set priority value</label>
            </div>
            <div id="priorityDiv" class="option-sub">
                <input type="text" name="priority" placeholder="Priority value">
            </div>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-T">
            <label>Create a thick jail</label>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-V">
            <label>Enable VNET. Interface must be a physical interface</label>
        </div>

        <div class="option-block">
            <div class="option-row">
                <input type="checkbox" class="option-checkbox" id="vlanCheckbox" value="-v">
                <label for="vlanCheckbox">Set VLAN ID (VNET only)</label>
            </div>
            <div id="vlanDiv" class="option-sub">
                <input type="text" name="vlan" placeholder="VLAN ID">
            </div>
        </div>

        <div class="option-row">
            <input type="checkbox" class="option-checkbox" value="-x">
            <label>Enable debug mode</label>
        </div>

        <div class="option-block">
            <div class="option-row">
                <input type="checkbox" class="option-checkbox" id="zfsCheckbox">
                <label for="zfsCheckbox">Custom zfs options. Comma-separated</label>
            </div>
            <div id="zfsDiv" class="option-sub">
                <input type="text" name="zfs" placeholder="ZFS options (comma-separated)">
            </div>
        </div>

    </fieldset>

    <button type="submit">Create</button>
</form>

<script>
function updateOptions() {
    const checkboxes = document.querySelectorAll('.option-checkbox');
    const optionsInput = document.getElementById('options');
    let opts = [];

	const valueFlags = ['gateway', 'priority', 'vlan', 'zfs'];

	checkboxes.forEach(cb => {
		if (cb.checked && cb.value && !valueFlags.includes(cb.id.replace('Checkbox',''))) {
			opts.push(cb.value); // push only simple checkboxes
		}
	});

	valueFlags.forEach(name => {
		const cb = document.getElementById(name + 'Checkbox');
		const el = document.querySelector(`input[name="${name}"]`);
		if (cb.checked && el && el.value.trim() !== "") {
			opts.push(cb.value + ' ' + el.value.trim()); // push combined
		}
	});

    optionsInput.value = opts.join(' ');
}

gatewayCheckbox.onchange = () => gatewayDiv.style.display = gatewayCheckbox.checked ? 'block' : 'none';
priorityCheckbox.onchange = () => priorityDiv.style.display = priorityCheckbox.checked ? 'block' : 'none';
vlanCheckbox.onchange = () => vlanDiv.style.display = vlanCheckbox.checked ? 'block' : 'none';
zfsCheckbox.onchange = () => zfsDiv.style.display = zfsCheckbox.checked ? 'block' : 'none';
</script>

{{if .Output}}<pre>{{.Output}}</pre>{{end}}
{{if .Error}}<div class="error">{{.Error}}</div>{{end}}

<a class="button" href="/">Back</a>
{{end}}